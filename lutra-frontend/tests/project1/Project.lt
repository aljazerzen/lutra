
module db {
  type invoice_ty = {id = int64, transaction_fee = float64, total = float64}

  let invoices: func (): [invoice_ty]
}

let my_func = func (x: int64): int64 -> x

func () -> (
  db::invoices()
#   | std::map(func this -> {
#     this,
#     transaction_fee = 0.8,
#     income = this.total - this.transaction_fee,
#   })
  | func (y: [db::invoice_ty]) -> my_func(y.0.id)
#   | std::filter(func this -> this.income > 5)
#   | std::filter(func this -> this.invoice_date >= @2010-01-16)
#   | group(
#     func this -> this.customer_id,
#     func partition -> (
#       partition
#       | std::aggregate(func columns -> {
#         sum_income = sum columns.income,
#         ct = count columns.customer_id,
#       })
#     )
#   )
)